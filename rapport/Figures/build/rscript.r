library(rgl)
open3d()
par3d(windowRect=c(0,0,800,800))
x <- matrix(seq(-1,1,len=50),50,50,byrow=F)
y <- -matrix(seq(-1,1,len=50),50,50,byrow=T)
z<-1+sin(2*x)*(-2*cos(y))
persp3d(x,y,z,col="white", texture="B.png",specular="black",box=F,axes=F,xlab="",zlab="",ylab="")
view3d(userMatrix= rotate3d(rotationMatrix(-0.3*pi/2, 1,0,0),-pi/9,0,0,1),fov=0, scale=c(1,1,1))
rgl.snapshot('test.png')
M = par3d("modelMatrix")
viewport = par3d("viewport")
bbox=par3d("bbox")
v=rbind(matrix(bbox[c(1,3,5,2,3,5,1,4,5,2,4,6)],3),rep(1,4))
u = M %*%v
P = par3d("projMatrix")
A<-P %*%u
a=A / outer(rep(1,4),A[4,])
(a[1,]+1)/2*(viewport[3]-viewport[1])
(a[2,]+1)/2*(viewport[4]-viewport[2])
sink("3dmapping.txt")
cat("(")
cat(v[1:3,1],sep=",")
cat(") => (")
cat((a[1,1]+1)/2*(viewport[3]-viewport[1]),(a[2,1]+1)/2*(viewport[3]-viewport[1]),sep=",")
cat(")\n")
cat("(")
cat(v[1:3,2],sep=",")
cat(") => (")
cat((a[1,2]+1)/2*(viewport[3]-viewport[1]),(a[2,2]+1)/2*(viewport[3]-viewport[1]),sep=",")
cat(")\n")
cat("(")
cat(v[1:3,3],sep=",")
cat(") => (")
cat((a[1,3]+1)/2*(viewport[3]-viewport[1]),(a[2,3]+1)/2*(viewport[3]-viewport[1]),sep=",")
cat(")\n")
cat("(")
cat(v[1:3,4],sep=",")
cat(") => (")
cat((a[1,4]+1)/2*(viewport[3]-viewport[1]),(a[2,4]+1)/2*(viewport[3]-viewport[1]),sep=",")
cat(")")
sink()
viewport
u
